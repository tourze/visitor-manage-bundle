{# 访客通行证详情页面模板 #}
{% extends '@EasyAdmin/crud/detail.html.twig' %}

{# 自定义页面标题 #}
{% block content_title %}
    访客通行证详情 - {{ entity.instance.passCode }}
{% endblock %}

{# 主要内容区域 #}
{% block main %}
    <div class="visitor-pass-detail-wrapper">
        {# 通行证状态总览卡片 #}
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fa fa-id-card me-2"></i>通行证状态总览
                </h5>
            </div>
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-3 mb-3">
                        <div class="field-group text-center">
                            <div class="field-label text-muted mb-2">通行码</div>
                            <div class="field-value">
                                <h4 class="mb-0">
                                    <span class="badge bg-dark pass-code-badge">
                                        <i class="fa fa-key me-1"></i>{{ entity.instance.passCode }}
                                    </span>
                                </h4>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="field-group text-center">
                            <div class="field-label text-muted">使用状态</div>
                            <div class="field-value">
                                {% if entity.instance.isUsed %}
                                    <h4 class="mb-0">
                                        <span class="badge bg-success">
                                            <i class="fa fa-check-circle me-1"></i>已使用
                                        </span>
                                    </h4>
                                {% else %}
                                    <h4 class="mb-0">
                                        <span class="badge bg-warning">
                                            <i class="fa fa-clock me-1"></i>未使用
                                        </span>
                                    </h4>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="field-group text-center">
                            <div class="field-label text-muted">有效期状态</div>
                            <div class="field-value">
                                {% set now = 'now'|date('U') %}
                                {% set validStart = entity.instance.validStartTime ? entity.instance.validStartTime.timestamp : 0 %}
                                {% set validEnd = entity.instance.validEndTime ? entity.instance.validEndTime.timestamp : 0 %}

                                {% if now < validStart %}
                                    <h4 class="mb-0">
                                        <span class="badge bg-info">
                                            <i class="fa fa-hourglass-start me-1"></i>未生效
                                        </span>
                                    </h4>
                                {% elseif now >= validStart and now <= validEnd %}
                                    <h4 class="mb-0">
                                        <span class="badge bg-success">
                                            <i class="fa fa-check-circle me-1"></i>有效期内
                                        </span>
                                    </h4>
                                {% else %}
                                    <h4 class="mb-0">
                                        <span class="badge bg-danger">
                                            <i class="fa fa-times-circle me-1"></i>已过期
                                        </span>
                                    </h4>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="field-group text-center">
                            <div class="field-label text-muted">通行证ID</div>
                            <div class="field-value">
                                <span class="badge bg-secondary">{{ entity.instance.id }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                {# 异常提示区域 #}
                {% if now > validEnd %}
                    <div class="alert alert-danger mb-0 mt-3">
                        <i class="fa fa-exclamation-triangle me-2"></i>
                        <strong>异常警告：</strong>
                        此通行证已过期，无法用于访客签到。请为访客重新生成通行证。
                    </div>
                {% elseif entity.instance.isUsed %}
                    <div class="alert alert-success mb-0 mt-3">
                        <i class="fa fa-info-circle me-2"></i>
                        <strong>使用记录：</strong>
                        此通行证已于 {{ entity.instance.useTime|date('Y-m-d H:i:s') }} 被使用完成。
                    </div>
                {% elseif now < validStart %}
                    <div class="alert alert-info mb-0 mt-3">
                        <i class="fa fa-clock me-2"></i>
                        <strong>提示：</strong>
                        此通行证尚未生效，将于 {{ entity.instance.validStartTime|date('Y-m-d H:i:s') }} 开始生效。
                    </div>
                {% else %}
                    <div class="alert alert-success mb-0 mt-3">
                        <i class="fa fa-check-circle me-2"></i>
                        <strong>通行证有效：</strong>
                        访客可使用此通行证在有效期内完成签到核验。
                    </div>
                {% endif %}
            </div>
        </div>

        {# 二维码预览卡片 #}
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="fa fa-qrcode me-2"></i>二维码预览
                </h5>
            </div>
            <div class="card-body text-center">
                {% if entity.instance.qrCode %}
                    <div class="qr-code-container mb-3">
                        {# 如果 qrCode 是 base64 编码的图片 #}
                        {% if entity.instance.qrCode starts with 'data:image' %}
                            <img src="{{ entity.instance.qrCode }}"
                                 alt="访客通行证二维码"
                                 class="qr-code-image">
                        {% else %}
                            {# 如果是纯文本内容，使用在线二维码生成服务或显示文本 #}
                            <div class="qr-code-text">
                                <p class="text-muted mb-2">二维码内容：</p>
                                <div class="alert alert-light border">
                                    <code>{{ entity.instance.qrCode }}</code>
                                </div>
                                <p class="text-muted small">
                                    <i class="fa fa-info-circle me-1"></i>
                                    前台扫码时将读取此内容进行核验
                                </p>
                            </div>
                        {% endif %}
                    </div>

                    <div class="qr-code-info">
                        <div class="alert alert-info mb-3">
                            <h6 class="alert-heading">
                                <i class="fa fa-mobile-alt me-2"></i>扫码核验说明
                            </h6>
                            <hr>
                            <ul class="mb-0 text-start">
                                <li>访客到达时，使用前台扫码设备扫描此二维码</li>
                                <li>系统将自动验证通行码有效性和有效期</li>
                                <li>核验通过后，自动记录签到时间并更新访客状态</li>
                                <li>每个通行证仅可使用一次，使用后无法重复扫码</li>
                            </ul>
                        </div>

                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-primary" onclick="printQRCode()">
                                <i class="fa fa-print me-1"></i>打印二维码
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="downloadQRCode()">
                                <i class="fa fa-download me-1"></i>下载二维码
                            </button>
                        </div>
                    </div>
                {% else %}
                    <div class="alert alert-warning mb-0">
                        <i class="fa fa-exclamation-triangle me-2"></i>
                        未生成二维码内容
                    </div>
                {% endif %}
            </div>
        </div>

        {# 通行证详细信息卡片 #}
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="fa fa-clipboard-list me-2"></i>通行证详细信息
                </h5>
            </div>
            <div class="card-body">
                <table class="table table-hover table-bordered pass-info-table">
                    <tbody>
                        <tr>
                            <th class="table-label" width="200">通行证ID</th>
                            <td>{{ entity.instance.id }}</td>
                        </tr>
                        <tr>
                            <th class="table-label">通行码</th>
                            <td>
                                <span class="badge bg-dark">{{ entity.instance.passCode }}</span>
                                <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="copyPassCode()">
                                    <i class="fa fa-copy me-1"></i>复制
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <th class="table-label">有效开始时间</th>
                            <td>
                                <i class="fa fa-calendar-alt me-1 text-success"></i>
                                {{ entity.instance.validStartTime|date('Y-m-d H:i:s') }}
                                <span class="text-muted ms-2">
                                    ({{ entity.instance.validStartTime|date('l') }})
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <th class="table-label">有效结束时间</th>
                            <td>
                                <i class="fa fa-calendar-times me-1 text-danger"></i>
                                {{ entity.instance.validEndTime|date('Y-m-d H:i:s') }}
                                <span class="text-muted ms-2">
                                    ({{ entity.instance.validEndTime|date('l') }})
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <th class="table-label">有效时长</th>
                            <td>
                                {% set duration = entity.instance.validEndTime.timestamp - entity.instance.validStartTime.timestamp %}
                                {% set days = (duration / 86400)|round(0, 'floor') %}
                                {% set hours = ((duration % 86400) / 3600)|round(0, 'floor') %}
                                {% set minutes = ((duration % 3600) / 60)|round(0, 'floor') %}

                                <span class="badge bg-info">
                                    {% if days > 0 %}{{ days }}天 {% endif %}
                                    {% if hours > 0 %}{{ hours }}小时 {% endif %}
                                    {% if minutes > 0 %}{{ minutes }}分钟{% endif %}
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <th class="table-label">使用时间</th>
                            <td>
                                {% if entity.instance.useTime %}
                                    <span class="text-success">
                                        <i class="fa fa-check-circle me-1"></i>
                                        {{ entity.instance.useTime|date('Y-m-d H:i:s') }}
                                    </span>
                                {% else %}
                                    <span class="text-muted">未使用</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th class="table-label">创建时间</th>
                            <td>
                                <i class="fa fa-clock me-1 text-info"></i>
                                {{ entity.instance.createTime|date('Y-m-d H:i:s') }}
                            </td>
                        </tr>
                        <tr>
                            <th class="table-label">使用状态</th>
                            <td>
                                {% if entity.instance.isUsed %}
                                    <span class="badge bg-success">
                                        <i class="fa fa-check-circle me-1"></i>已使用
                                    </span>
                                {% else %}
                                    <span class="badge bg-warning">
                                        <i class="fa fa-clock me-1"></i>未使用
                                    </span>
                                {% endif %}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        {# 关联访客信息卡片 #}
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i class="fa fa-user me-2"></i>关联访客信息
                </h5>
            </div>
            <div class="card-body">
                {% set visitor = entity.instance.visitor %}
                {% if visitor %}
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="field-group">
                                <div class="field-label text-muted">访客姓名</div>
                                <div class="field-value fw-bold">{{ visitor.name }}</div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="field-group">
                                <div class="field-label text-muted">手机号码</div>
                                <div class="field-value">{{ visitor.mobile }}</div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="field-group">
                                <div class="field-label text-muted">公司名称</div>
                                <div class="field-value">{{ visitor.company ?: '未提供' }}</div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="field-group">
                                <div class="field-label text-muted">身份证号</div>
                                <div class="field-value">{{ visitor.idCard ?: '未提供' }}</div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="field-group">
                                <div class="field-label text-muted">车牌号</div>
                                <div class="field-value">{{ visitor.vehicleNumber ?: '无' }}</div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="field-group">
                                <div class="field-label text-muted">访客状态</div>
                                <div class="field-value">
                                    {% set status = visitor.status %}
                                    {% set badgeClass = 'secondary' %}
                                    {% if status.value == 'pending' %}
                                        {% set badgeClass = 'warning' %}
                                    {% elseif status.value == 'approved' %}
                                        {% set badgeClass = 'success' %}
                                    {% elseif status.value == 'rejected' %}
                                        {% set badgeClass = 'danger' %}
                                    {% elseif status.value == 'signed_in' %}
                                        {% set badgeClass = 'info' %}
                                    {% elseif status.value == 'signed_out' %}
                                        {% set badgeClass = 'secondary' %}
                                    {% elseif status.value == 'cancelled' %}
                                        {% set badgeClass = 'dark' %}
                                    {% endif %}
                                    <span class="badge bg-{{ badgeClass }}">{{ status.label }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 mb-3">
                            <div class="field-group">
                                <div class="field-label text-muted">来访事由</div>
                                <div class="field-value">{{ visitor.reason }}</div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="field-group">
                                <div class="field-label text-muted">预约时间</div>
                                <div class="field-value">
                                    {% if visitor.appointmentTime %}
                                        {{ visitor.appointmentTime|date('Y-m-d H:i:s') }}
                                    {% else %}
                                        未设置
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="field-group">
                                <div class="field-label text-muted">访客ID</div>
                                <div class="field-value">
                                    <span class="badge bg-secondary">{{ visitor.id }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {# 快捷链接到访客详情 #}
                    <div class="mt-3">
                        <a href="{{ ea_url()
                            .setController('Tourze\\VisitorManageBundle\\Controller\\VisitorCrudController')
                            .setAction('detail')
                            .setEntityId(visitor.id) }}"
                           class="btn btn-sm btn-outline-primary">
                            <i class="fa fa-external-link-alt me-1"></i>查看完整访客信息
                        </a>
                    </div>
                {% else %}
                    <div class="alert alert-warning mb-0">
                        <i class="fa fa-exclamation-triangle me-2"></i>
                        未找到关联访客信息
                    </div>
                {% endif %}
            </div>
        </div>

        {# 安全验证流程说明卡片 #}
        <div class="card mb-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">
                    <i class="fa fa-shield-alt me-2"></i>安全验证流程
                </h5>
            </div>
            <div class="card-body">
                <div class="security-flow">
                    <div class="flow-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h6 class="step-title">生成通行证</h6>
                            <p class="step-desc text-muted">系统为已审批通过的访客自动生成唯一通行码和二维码</p>
                        </div>
                    </div>
                    <div class="flow-arrow">
                        <i class="fa fa-arrow-down"></i>
                    </div>
                    <div class="flow-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h6 class="step-title">发送通行证</h6>
                            <p class="step-desc text-muted">通过短信或邮件将通行码和二维码发送给访客</p>
                        </div>
                    </div>
                    <div class="flow-arrow">
                        <i class="fa fa-arrow-down"></i>
                    </div>
                    <div class="flow-step {{ entity.instance.isUsed ? '' : 'active' }}">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h6 class="step-title">前台扫码核验</h6>
                            <p class="step-desc text-muted">访客到达时，在前台使用扫码设备扫描二维码进行身份核验</p>
                        </div>
                    </div>
                    <div class="flow-arrow">
                        <i class="fa fa-arrow-down"></i>
                    </div>
                    <div class="flow-step {{ entity.instance.isUsed ? 'active' : '' }}">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h6 class="step-title">系统验证</h6>
                            <p class="step-desc text-muted">
                                {% if entity.instance.isUsed %}
                                    <span class="badge bg-success">验证完成</span>
                                    系统已验证通行码有效性、有效期及使用状态
                                {% else %}
                                    系统自动验证：通行码有效性、有效期范围、是否已使用
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    <div class="flow-arrow">
                        <i class="fa fa-arrow-down"></i>
                    </div>
                    <div class="flow-step {{ entity.instance.isUsed ? 'active' : '' }}">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h6 class="step-title">签到完成</h6>
                            <p class="step-desc text-muted">
                                {% if entity.instance.isUsed %}
                                    <span class="badge bg-success">已完成</span>
                                    于 {{ entity.instance.useTime|date('Y-m-d H:i:s') }} 完成签到
                                {% else %}
                                    验证通过后，自动记录签到时间并标记通行证为已使用
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>

                {# 验证规则说明 #}
                <div class="alert alert-light border mt-4 mb-0">
                    <h6 class="alert-heading">
                        <i class="fa fa-lock me-2"></i>安全验证规则
                    </h6>
                    <hr>
                    <ul class="mb-0">
                        <li><strong>唯一性验证：</strong>每个通行码全局唯一，确保无法伪造</li>
                        <li><strong>时效性验证：</strong>当前时间必须在有效开始时间和有效结束时间之间</li>
                        <li><strong>单次使用：</strong>每个通行证仅可使用一次，使用后自动失效</li>
                        <li><strong>关联验证：</strong>验证访客身份与通行证的关联关系</li>
                        <li><strong>状态验证：</strong>确认访客状态为已审批通过</li>
                    </ul>
                </div>
            </div>
        </div>

        {# 访客签到信息卡片 #}
        <div class="card mb-4">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">
                    <i class="fa fa-history me-2"></i>访客签到信息
                </h5>
            </div>
            <div class="card-body">
                {% if entity.instance.visitor %}
                    <table class="table table-hover table-bordered mb-0">
                        <tbody>
                            <tr>
                                <th class="table-label" width="200">签入时间</th>
                                <td>
                                    {% if entity.instance.visitor.signInTime %}
                                        <span class="text-success">
                                            <i class="fa fa-check-circle me-1"></i>
                                            {{ entity.instance.visitor.signInTime|date('Y-m-d H:i:s') }}
                                        </span>
                                    {% else %}
                                        <span class="text-muted">未签入</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th class="table-label">签出时间</th>
                                <td>
                                    {% if entity.instance.visitor.signOutTime %}
                                        <span class="text-primary">
                                            <i class="fa fa-sign-out-alt me-1"></i>
                                            {{ entity.instance.visitor.signOutTime|date('Y-m-d H:i:s') }}
                                        </span>
                                    {% else %}
                                        <span class="text-muted">未签出</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th class="table-label">在访时长</th>
                                <td>
                                    {% if entity.instance.visitor.signInTime and entity.instance.visitor.signOutTime %}
                                        {% set visitDuration = entity.instance.visitor.signOutTime.timestamp - entity.instance.visitor.signInTime.timestamp %}
                                        {% set vHours = (visitDuration / 3600)|round(0, 'floor') %}
                                        {% set vMinutes = ((visitDuration % 3600) / 60)|round(0, 'floor') %}

                                        <span class="badge bg-info">
                                            {% if vHours > 0 %}{{ vHours }}小时 {% endif %}
                                            {{ vMinutes }}分钟
                                        </span>
                                    {% elseif entity.instance.visitor.signInTime %}
                                        <span class="text-info">
                                            <i class="fa fa-clock me-1"></i>访客在场中...
                                        </span>
                                    {% else %}
                                        <span class="text-muted">--</span>
                                    {% endif %}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                {% else %}
                    <div class="alert alert-warning mb-0">
                        <i class="fa fa-exclamation-triangle me-2"></i>
                        未找到关联访客的签到信息
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    {# 保留原始的删除表单 #}
    {% block delete_form %}
        {{ include('@EasyAdmin/crud/includes/_delete_form.html.twig', { entity_id: entity.primaryKeyValue }, with_context = false) }}
    {% endblock delete_form %}
{% endblock %}

{# 自定义样式 #}
{% block configured_stylesheets %}
    {{ parent() }}
    <style>
        /* 卡片样式 */
        .visitor-pass-detail-wrapper .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        .visitor-pass-detail-wrapper .card-header {
            border-bottom: none;
            padding: 1rem 1.25rem;
        }
        .visitor-pass-detail-wrapper .card-header h5 {
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* 字段组样式 */
        .visitor-pass-detail-wrapper .field-group {
            padding: 0.5rem 0;
        }
        .visitor-pass-detail-wrapper .field-label {
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
            font-weight: 500;
        }
        .visitor-pass-detail-wrapper .field-value {
            font-size: 1rem;
            color: #212529;
        }

        /* 徽章样式 */
        .visitor-pass-detail-wrapper .pass-code-badge {
            font-size: 1.3rem;
            padding: 0.6rem 1.5rem;
            border-radius: 0.5rem;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
        }
        .visitor-pass-detail-wrapper .badge {
            font-size: 0.875rem;
            padding: 0.375rem 0.75rem;
        }

        /* 二维码容器样式 */
        .visitor-pass-detail-wrapper .qr-code-container {
            padding: 2rem;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 1rem;
            display: inline-block;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        .visitor-pass-detail-wrapper .qr-code-image {
            max-width: 300px;
            max-height: 300px;
            border: 5px solid white;
            border-radius: 0.5rem;
            box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1);
        }
        .visitor-pass-detail-wrapper .qr-code-text {
            max-width: 500px;
            margin: 0 auto;
        }

        /* 表格样式 */
        .visitor-pass-detail-wrapper .pass-info-table,
        .visitor-pass-detail-wrapper table {
            margin-bottom: 0;
        }
        .visitor-pass-detail-wrapper th.table-label {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
            vertical-align: middle;
        }
        .visitor-pass-detail-wrapper td {
            vertical-align: middle;
        }

        /* 安全流程样式 */
        .visitor-pass-detail-wrapper .security-flow {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
        }
        .visitor-pass-detail-wrapper .flow-step {
            display: flex;
            align-items: flex-start;
            width: 100%;
            max-width: 600px;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 0.5rem;
            border-left: 4px solid #6c757d;
            transition: all 0.3s ease;
        }
        .visitor-pass-detail-wrapper .flow-step.active {
            background-color: #e7f3ff;
            border-left-color: #0d6efd;
            box-shadow: 0 0.25rem 0.5rem rgba(13, 110, 253, 0.2);
        }
        .visitor-pass-detail-wrapper .flow-step .step-number {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #6c757d;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            margin-right: 1rem;
        }
        .visitor-pass-detail-wrapper .flow-step.active .step-number {
            background-color: #0d6efd;
        }
        .visitor-pass-detail-wrapper .flow-step .step-content {
            flex-grow: 1;
        }
        .visitor-pass-detail-wrapper .flow-step .step-title {
            margin-bottom: 0.25rem;
            font-weight: 600;
            color: #212529;
        }
        .visitor-pass-detail-wrapper .flow-step .step-desc {
            margin-bottom: 0;
            font-size: 0.9rem;
        }
        .visitor-pass-detail-wrapper .flow-arrow {
            color: #6c757d;
            font-size: 1.5rem;
            margin: 0.5rem 0;
        }

        /* 警告框样式 */
        .visitor-pass-detail-wrapper .alert {
            border-left: 4px solid;
        }
        .visitor-pass-detail-wrapper .alert-info {
            border-left-color: #0dcaf0;
        }
        .visitor-pass-detail-wrapper .alert-success {
            border-left-color: #198754;
        }
        .visitor-pass-detail-wrapper .alert-warning {
            border-left-color: #ffc107;
        }
        .visitor-pass-detail-wrapper .alert-danger {
            border-left-color: #dc3545;
        }

        /* 打印样式 */
        @media print {
            .visitor-pass-detail-wrapper .card:not(:has(.qr-code-container)) {
                display: none;
            }
            .visitor-pass-detail-wrapper .btn-group {
                display: none;
            }
        }
    </style>
{% endblock %}

{# 自定义脚本 #}
{% block configured_javascripts %}
    {{ parent() }}
    <script>
        // 复制通行码到剪贴板
        function copyPassCode() {
            const passCode = '{{ entity.instance.passCode }}';
            navigator.clipboard.writeText(passCode).then(function() {
                alert('通行码已复制到剪贴板: ' + passCode);
            }, function(err) {
                console.error('复制失败:', err);
                alert('复制失败，请手动复制');
            });
        }

        // 打印二维码
        function printQRCode() {
            window.print();
        }

        // 下载二维码
        function downloadQRCode() {
            const qrCodeImage = document.querySelector('.qr-code-image');
            if (qrCodeImage) {
                const link = document.createElement('a');
                link.href = qrCodeImage.src;
                link.download = '通行证_{{ entity.instance.passCode }}.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                alert('未找到二维码图片，无法下载');
            }
        }
    </script>
{% endblock %}
